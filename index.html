      <!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="format-detection" content="telephone=no">
  <title>Reservas | Panel de Trabajo</title>

  <link rel="preconnect" href=                                                                                                                          "https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- CSS cr√≠tico y seguro para m√≥vil -->
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; -webkit-text-size-adjust: 100%; }
    img, video, canvas, svg { max-width: 100%; height: auto; display: block; }
    .table { display: block; width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .container { width: min(100%, 92vw); margin: 0 auto; }
  </style>

  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <div class="container">
    <!-- Header -->
    <header class="header" role="banner" aria-label="Encabezado del panel">
      <div class="header__titles">
        <h1 class="header__title">Panel de Reservas</h1>
        <p class="header__subtitle">
          <span>Hoy es</span>
          <time id="hoyFecha" aria-live="polite">--</time>
        </p>
      </div>

      <nav class="actions" aria-label="Acciones principales">
        <!-- HOY -->
        <button class="btn btn--ghost" id="btnHoy" type="button" aria-label="Ir al panel de hoy">
          <svg class="btn__icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3.172 3.586 11.586a1 1 0 0 0 1.414 1.414L6 12.999V20a1 1 0 0 0 1 1h4v-5h2v5h4a1 1 0 0 0 1-1v-7.001l1 1.001a1 1 0 1 0 1.414-1.414L12 3.172z"/></svg>
          Hoy
        </button>

        <!-- Crear Reserva -->
        <button class="btn" id="btnCrear" type="button" aria-label="Crear nueva reserva">
          <svg class="btn__icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M11 11V5a1 1 0 1 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6z"/></svg>
          Crear Reserva
        </button>

        <!-- Ficha T√©cnica -->
        <button class="btn btn--ghost" id="btnFicha" type="button" aria-label="Abrir ficha t√©cnica">
          <svg class="btn__icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M7 3h7l5 5v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zm7 1.5V8h3.5L14 4.5z"/></svg>
          Ficha T√©cnica
        </button>

        <!-- Pre-reserva -->
        <button class="btn btn--ghost" id="btnPreReserva" type="button" aria-label="Abrir pre-reserva">
          <svg class="btn__icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a2 2 0 0 1 2 2v3H2V6a2 2 0 0 1 2-2h1V3a1 1 0 1 1 2 0v1zM2 10h20v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-8zm3 3h10a1 1 0 1 1 0 2H5a1 1 0 1 1 0-2z"/>
          </svg>
          Pre-reserva
        </button>

        <!-- Calendario -->
        <button class="btn btn--ghost" id="btnCalendario" type="button" aria-label="Ver calendario">
  <svg class="btn__icon" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a2 2 0 0 1 2 2v3H2V6a2 2 0 0 1 2-2h1V3a1 1 0 1 1 2 0v1zM2 10h20v8a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-8zm5 3a1 1 0 1 0 0 2h3a1 1 0 1 0 0-2H7z"/>
  </svg>
  Calendario
</button>


<!-- Actualizar (NUEVO) -->
      <button class="btn btn--ghost" id="btnRefrescar" type="button" aria-label="Actualizar datos">
        <svg class="btn__icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 4V1L8 5l4 4V6a6 6 0 1 1-6 6H4a8 8 0 1 0 8-8z"/>
        </svg>
        Actualizar
      </button>
      </nav>
    </header>

    <!-- HOME -->
    <main class="main" role="main" id="homeView">
      <!-- HOY -->
      <section class="section" aria-labelledby="hoyHeading">
        <div class="section__header">
          <h2 id="hoyHeading" class="section__title">HOY</h2>
          <p class="section__description">Reservas, pre-reservas y cumplea√±os del d√≠a.</p>
        </div>

        <div class="grid grid--2">
          <!-- Turnos de hoy -->
          <article class="card" aria-labelledby="turnosHoyHeading" data-collapsible>
            <div class="card__header">
              <h3 id="turnosHoyHeading" class="card__title">Turnos</h3>
              <div class="card__header-actions">
                <span class="badge" id="turnosHoyCount" aria-live="polite">0</span>
                <button class="card__toggle"
                        type="button"
                        aria-expanded="false"
                        aria-controls="turnosHoyContent"
                        title="Mostrar/ocultar">
                  ‚ñº
                </button>
              </div>
            </div>
            <div class="card__content" id="turnosHoyContent" hidden>
              <ul class="list" id="turnosHoyList" aria-live="polite"></ul>
              <div class="card__empty" id="turnosHoyEmpty" hidden>No hay turnos hoy.</div>
            </div>
          </article>

          <!-- Cumplea√±os hoy -->
          <article class="card" aria-labelledby="cumplesHoyHeading" data-collapsible>
            <div class="card__header">
              <h3 id="cumplesHoyHeading" class="card__title">Cumplea√±os</h3>
              <div class="card__header-actions">
                <span class="badge" id="cumplesHoyCount" aria-live="polite">0</span>
                <button class="card__toggle" 
                        type="button"
                        aria-expanded="false"
                        aria-controls="cumplesHoyContent"
                        title="Mostrar/ocultar">
                  ‚ñº
                </button>
              </div>
            </div>
            <div class="card__content" id="cumplesHoyContent" hidden>
              <ul class="list" id="hoyCumplesHoyList" aria-live="polite"></ul>
              <div class="card__empty" id="hoyCumplesHoyEmpty" hidden>No hay cumplea√±os hoy.</div>
            </div>
          </article>
        </div>
      </section>

      <!-- Recordatorios -->
      <section class="section" aria-labelledby="recordatoriosHeading">
        <div class="section__header">
          <h2 id="recordatoriosHeading" class="section__title">Recordatorios</h2>
        </div>

        <div class="grid grid--2">
          <!-- Reservas por confirmar -->
          <article class="card" aria-labelledby="confirmarHeading" data-collapsible>
            <div class="card__header">
              <h3 id="confirmarHeading" class="card__title">Reservas por confirmar</h3>
              <div class="card__header-actions">
                <span class="badge" id="confirmarCount" aria-live="polite">0</span>
                <button class="card__toggle"
                        type="button"
                        aria-expanded="false"
                        aria-controls="confirmarContent"
                        title="Mostrar/ocultar">
                  ‚ñº
                </button>
              </div>
            </div>
            <div class="card__content" id="confirmarContent" hidden>
              <ul class="list" id="hoyPreReservasList" aria-live="polite"></ul>
              <div class="card__empty" id="hoyPreReservasEmpty" hidden>No hay reservas por confirmar.</div>
            </div>
          </article>
        </div>
      </section>
    </main>

    <!-- Vista: Pre-reserva -->
    <section class="section" id="preReservaView" hidden aria-labelledby="preReservaHeading">
      <div class="section__header">
        <h2 id="preReservaHeading" class="section__title">Pre-reserva</h2>
        <p class="section__description">Busca un cliente con ficha t√©cnica y elige fecha y hora.</p>
      </div>

      <div class="card">
        <div class="card__header">
          <h3 class="card__title">Seleccionar cliente</h3>
        </div>

        <div class="form__grid">
          <label class="form__field form__field--full">
            <span>Buscar cliente (nombre o tel√©fono)</span>
            <input type="text" id="preBuscador" placeholder="Ej. Ana, +57 3..." autocomplete="off" />
          </label>

          <div class="form__field form__field--full" id="preResultadosWrap" hidden>
            <div id="preResultados" class="list"></div>
            <div class="card__empty" id="preResultadosEmpty" hidden>No se encontraron clientes con ficha.</div>
          </div>

          <div class="form__field form__field--full" id="preSeleccionadoWrap" hidden>
            <span>Cliente seleccionado</span>
            <div id="preSeleccionado" class="table__chip"></div>
          </div>

          <label class="form__field">
            <span>Fecha</span>
            <input type="date" id="preFecha" />
          </label>
          <label class="form__field">
            <span>Hora</span>
            <input type="time" id="preHora" />
          </label>
        </div>

        <div class="modal__footer">
          <button type="button" class="btn btn--ghost" id="preCancelar">Cancelar</button>
          <button type="button" class="btn" id="preGuardar" disabled>Guardar pre-reserva</button>
        </div>
      </div>
    </section>

    <!-- Vista: Fichas T√©cnicas -->
    <section class="section" id="fichasView" hidden aria-labelledby="fichasHeading">
      <div class="section__header section__header--row">
        <div class="section__titlebar">
          <h2 id="fichasHeading" class="section__title">Fichas T√©cnicas</h2>

          <div class="toggle" id="tipoToggle" role="group" aria-label="Tipo de ficha">
            <button type="button" class="toggle__btn is-active" data-type="Pesta√±as" aria-pressed="true">Pesta√±as</button>
            <button type="button" class="toggle__btn" data-type="Faciales" aria-pressed="false">Faciales</button>
          </div>
        </div>

        <p class="section__description">Revisa las fichas existentes o crea una nueva.</p>
      </div>

      <div class="card">
        <div class="card__header">
          <h3 class="card__title">Listado</h3>
          <button class="btn" id="btnCrearFicha" type="button">Crear Ficha T√©cnica</button>
        </div>

        <!-- ‚úÖ NUEVA VERSI√ìN: listado tipo ‚Äúbloques‚Äù -->
<ul class="list" id="fichasList" aria-live="polite"></ul>


<!-- Template de √≠tem de ficha (nombre + botones) -->
<template id="tplFichaItem">
  <li class="list__item" data-id="" data-type="">
    <div class="list__main">
      <span class="list__title"></span>
    </div>
    <div class="list__actions">
      <button type="button" class="btn btn--soft js-view" aria-label="Ver ficha">Ver</button>
      <button type="button" class="btn btn--soft js-edit" aria-label="Editar ficha">Editar</button>
      <button type="button" class="btn btn--soft js-delete" aria-label="Eliminar ficha">Eliminar</button>
    </div>
  </li>
</template>


<!-- Mensaje si no hay fichas -->
<div class="card__empty" id="fichasEmpty" hidden>
  No hay fichas creadas todav√≠a.
</div>

    </section>



    <!-- Vista: Calendario -->
<section class="section" id="calendarioView" hidden aria-labelledby="calendarioHeading">
  <div class="section__header">
    <h2 id="calendarioHeading" class="section__title">Calendario</h2>
    <p class="section__description">Reservas & pre-reservas del mes.</p>
  </div>

  <article class="card" aria-label="Calendario mensual">
    <!-- Barra de controles -->
    <header class="calendar__header">
      <div class="calendar__controls">
        <button type="button" class="btn btn--ghost" id="calPrev" aria-label="Mes anterior">‚óÄ</button>
        <h3 class="calendar__title" id="calTitle" aria-live="polite">‚Äî</h3>
        <button type="button" class="btn btn--ghost" id="calNext" aria-label="Mes siguiente">‚ñ∂</button>
      </div>
    </header>

    <!-- Encabezado de d√≠as -->
    <div class="calendar__weekdays">
      <span>L</span><span>M</span><span>X</span><span>J</span><span>V</span><span>S</span><span>D</span>
    </div>

    <!-- Grilla principal -->
    <div id="calGrid" class="calendar__grid" role="grid" aria-live="polite"></div>
    <!-- Lista de eventos del d√≠a (debajo del calendario) -->
    <div id="calDayInline" class="caldaylist" hidden></div>

  </article>
</section>



    <!-- Footer -->
<footer class="footer" role="contentinfo">
  <small>¬© 2025 LUAR. Todos los derechos reservados.</small>
</footer>


  <!-- MODAL: Crear Ficha -->
  <div class="modal" id="fichaModal" aria-hidden="true">
    <div class="modal__overlay" data-close="true"></div>
    <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="fichaModalTitle">
      <div class="modal__header">
        <h3 id="fichaModalTitle">Crear Ficha T√©cnica</h3>
        <button class="modal__close" type="button" aria-label="Cerrar" data-close="true">‚úï</button>
      </div>

      <!-- FORM PESTA√ëAS -->
      <form id="fichaFormPestanas" class="form" data-form="pestanas">
        <div class="form__grid">
          <label class="form__field"><span>Nombre *</span><input type="text" name="nombre" required placeholder="Nombre y apellidos" /></label>
          <label class="form__field"><span>N√∫mero de tel√©fono *</span><input type="tel" name="telefono" required placeholder="+53 ..." /></label>
          <label class="form__field"><span>Correo</span><input type="email" name="correo" placeholder="correo@ejemplo.com" /></label>
          <label class="form__field"><span>Fecha de cumplea√±os (d√≠a/mes/a√±o)</span><input type="date" name="cumple" placeholder="dd/mm/aaaa" /></label>

          <label class="form__field form__field--full"><span>Alergias (especificar tipo)</span><input type="text" name="alergias" placeholder="Alergia al l√°tex" /></label>
          <label class="form__field"><span>Tipo</span><input type="text" name="grosor" placeholder="0.07" /></label>
          <label class="form__field"><span>Medida</span><input type="text" name="medida" placeholder="12" /></label>

          <label class="form__field">
            <span>Forma de ojos *</span>
            <select name="forma_ojos" required>
              <option value="">Selecciona</option>
              <option>Redondo</option>
              <option>Ovalado</option>
              <option>Asi√°tico</option>
              <option>Hundido</option>
            </select>
          </label>

          <label class="form__field">
            <span>Tipo de dise√±o</span>
            <input type="text" name="tipo_diseno" placeholder="Ej. Cat eye, Doll, Fox..." />
          </label>
        </div>

        <label class="form__field form__field--full">
          <span>Notas</span>
          <textarea name="notas" rows="3" placeholder="Escribe aqu√≠ alguna nota especial..."></textarea>
        </label>

        <div class="modal__footer">
          <button type="button" class="btn btn--ghost" data-close="true">Cancelar</button>
          <button type="submit" class="btn">Guardar ficha</button>
        </div>
      </form>

      <!-- FORM FACIALES -->
      <form id="fichaFormFaciales" class="form" data-form="faciales" hidden>
        <div class="form__grid">
          <label class="form__field"><span>Nombre *</span><input type="text" name="nombre" required placeholder="Nombre y apellidos" /></label>
          <label class="form__field"><span>N√∫mero de tel√©fono *</span><input type="tel" name="telefono" required placeholder="+53 ..." /></label>
          <label class="form__field"><span>Correo</span><input type="email" name="correo" placeholder="correo@ejemplo.com" /></label>
          <label class="form__field"><span>Fecha de cumplea√±os (d√≠a/mes/a√±o)</span><input type="date" name="cumple" placeholder="dd/mm/aaaa" /></label>

          <label class="form__field"><span>Edad</span><input type="number" name="edad" min="0" step="1" placeholder="Ej: 29" /></label>

          <label class="form__field">
            <span>G√©nero</span>
            <select name="genero">
              <option value="">Selecciona</option>
              <option>Femenino</option>
              <option>Masculino</option>
            </select>
          </label>

          <label class="form__field form__field--full">
            <span>Motivo de consulta</span>
            <textarea name="motivo_consulta" rows="3" placeholder="Describe el motivo de la consulta..."></textarea>
          </label>

          <div class="form__field form__field--full">
            <span>Manchas (selecci√≥n m√∫ltiple)</span>
            <div class="msel__group">
              <label><input type="checkbox" name="manchas[]" value="Melasma" /> Melasma</label>
              <label><input type="checkbox" name="manchas[]" value="L√©ntigos solares" /> L√©ntigos solares</label>
              <label><input type="checkbox" name="manchas[]" value="Acn√©" /> Acn√©</label>
              <label><input type="checkbox" name="manchas[]" value="Puntos negros" /> Puntos negros</label>
              <label><input type="checkbox" name="manchas[]" value="Puntos blancos" /> Puntos blancos</label>
              <label><input type="checkbox" name="manchas[]" value="P√°pula" /> P√°pula</label>
              <label><input type="checkbox" name="manchas[]" value="P√∫stula" /> P√∫stula</label>
              <label><input type="checkbox" name="manchas[]" value="C√≥medon abierto" /> C√≥medon abierto</label>
              <label><input type="checkbox" name="manchas[]" value="C√≥medon cerrado" /> C√≥medon cerrado</label>
              <label><input type="checkbox" name="manchas[]" value="Secuelas de Acn√©" /> Secuelas de Acn√©</label>
              <label><input type="checkbox" name="manchas[]" value="Ros√°cea" /> Ros√°cea</label>
              <label><input type="checkbox" name="manchas[]" value="Arrugas" /> Arrugas</label>
            </div>
          </div>

          <label class="form__field form__field--full">
            <span>Procedimiento</span>
            <textarea name="procedimiento" rows="3" placeholder="Detalle del procedimiento a realizar..."></textarea>
          </label>

          <label class="form__field">
            <span>Tipo de limpieza</span>
            <select name="tipo_limpieza">
              <option value="">Selecciona</option>
              <option>Limpieza b√°sica</option>
              <option>Limpieza media hidratante</option>
              <option>Limpieza profunda con masaje</option>
            </select>
          </label>
        </div>

        <label class="form__field form__field--full">
          <span>Notas</span>
          <textarea name="notas" rows="3" placeholder="Escribe aqu√≠ alguna nota especial..."></textarea>
        </label>

        <div class="modal__footer">
          <button type="button" class="btn btn--ghost" data-close="true">Cancelar</button>
          <button type="submit" class="btn">Guardar ficha</button>
        </div>
      </form>
    </div>
  </div>

 <!-- MODAL: Crear Reserva -->
<!-- MODAL: Crear Reserva -->
<div class="modal" id="reservaModal" aria-hidden="true">
  <div class="modal__overlay" data-close="true"></div>
  <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="reservaModalTitle">
    <div class="modal__header">
      <h3 id="reservaModalTitle">Crear Reserva</h3>
      <button class="modal__close" type="button" aria-label="Cerrar" data-close="true">‚úï</button>
    </div>

    <form id="reservaForm" class="form">
      <!-- üÜî Campo oculto para identificar la reserva al editar -->
      <input type="hidden" id="reservaId" name="id" />

      <div class="form__grid">
        <label class="form__field">
          <span>Nombre *</span>
          <input type="text" name="nombre" id="resNombre" required placeholder="Nombre y apellidos" />
        </label>

        <label class="form__field">
          <span>Servicio *</span>
          <select name="servicio" id="resServicio" required>
            <option value="">Elegir</option>
            <option value="Pesta√±as">Pesta√±as</option>
            <option value="Facial">Facial</option>
          </select>
        </label>

        <label class="form__field">
          <span>Fecha *</span>
          <input type="date" name="fecha" id="resFecha" required />
        </label>

        <label class="form__field">
          <span>Hora *</span>
          <input type="time" name="hora" id="resHora" required />
        </label>

        <label class="form__field">
          <span>Adelanto</span>
          <input type="number" name="adelanto" id="resAdelanto" min="0" step="0.01" placeholder="0.00" />
        </label>

        <label class="form__field">
          <span>Precio</span>
          <input type="number" name="precio" id="resPrecio" min="0" step="0.01" placeholder="0.00" />
        </label>
      </div>

      <!-- Aqu√≠ ir√° el CTA din√°mico que llena app.js -->
      <div id="reservaCta" class="mt-3" aria-live="polite"></div>

      <div class="modal__footer">
        <button type="button" class="btn btn--ghost" data-close="true" id="resCancelar">Cancelar</button>
        <button type="submit" class="btn" id="resGuardar">Guardar reserva</button>
      </div>
    </form>
  </div>
</div>


<script src="./app.js" defer></script>

  <!-- Contenedor de toasts -->
<div id="toaster" aria-live="polite"></div>

<!-- Modal gen√©rico para errores (usa tu CSS .modal) -->
<div id="errorModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="errorTitle">
  <div class="modal__overlay" data-close="modal"></div>
  <div class="modal__content">
    <header class="modal__header">
      <h3 id="errorTitle">Error</h3>
      <button class="modal__close" data-close="modal">Cerrar</button>
    </header>
    <div class="modal__body" id="errorBody"></div>
    <footer class="modal__footer">
      <button class="btn btn--ghost" data-close="modal">Entendido</button>
    </footer>
  </div>
</div>


<!-- Popup ficha t√©cnica -->
<div id="fichaPopup" class="popup" hidden>
  <div class="popup__header">
    <span>Ficha t√©cnica ‚Äî Pesta√±as</span>
    <button type="button" onclick="this.closest('#fichaPopup').classList.remove('is-visible')">‚úï</button>
  </div>
  <div class="popup__body">
    <p>Cargando...</p>
  </div>
</div>


</body>
</html>
